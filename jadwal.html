<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Piket Pustakawan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Mengimpor Font Inter untuk tampilan modern */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* Pengaturan Body dan Layout Utama (Full White Background) */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: auto; 
        }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: white; /* Diubah menjadi PUTIH */
            display: flex;
            justify-content: center;
            align-items: flex-start; 
            padding: 3rem 0; 
        }
        
        /* Style untuk container utama (Kartu Sudut Lembut) */
        .container-card {
            background-color: white;
            border-radius: 16px; 
            /* Pertahankan bayangan halus agar tetap megah/menarik */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1); 
            max-width: 95%; 
            width: 1200px; 
            margin: 0 auto;
            overflow: hidden; 
            border: 1px solid #e5e7eb; /* Tambahkan garis tipis agar kartu terlihat jelas di latar putih */
        }
        
        /* Table Styles */
        th, td {
            padding: 16px 12px; 
            text-align: left;
            border-right: 1px solid #f1f5f9; 
            border-bottom: 1px solid #f1f5f9; 
            overflow: hidden;
            vertical-align: top;
            transition: background-color 0.2s;
        }

        /* Hover pada sel hari untuk interaksi yang lembut */
        td:not(:first-child):hover {
            background-color: #f8fafc; 
        }

        /* Kolom untuk Shift/Waktu */
        th:first-child, td:first-child {
            width: 15%; 
            font-weight: 600;
            background-color: #f8fafc; 
            border-right: 2px solid #e2e8f0; 
        }
        /* Kolom Hari dibagi rata */
        th:not(:first-child), td:not(:first-child) {
            width: calc(85% / 7); 
        }

        /* Style untuk Header Kolom (Hari) */
        th {
            background-color: #ecfeff; /* Cyan-50 */
            color: #0e7490; /* Cyan-700 */
            font-weight: 700;
            /* Aksen Garis Cyan yang Megah di atas */
            border-top: 4px solid #06b6d4; 
            position: sticky; 
            top: 0;
            z-index: 10;
        }
        
        /* Menghilangkan border pada kolom dan baris terakhir */
        th:last-child, td:last-child {
            border-right: none;
        }
        tr:last-child td {
            border-bottom: none;
        }

        /* NEW DIVIDER STYLES */
        .divider-row td {
            height: 35px;
            font-weight: 700;
            text-transform: uppercase;
            color: white;
            text-align: center !important;
            font-size: 0.9rem;
            padding: 8px;
            border-right: none;
            border-bottom: none;
            cursor: default;
        }
        /* Menggunakan Cyan sebagai warna dominan */
        .divider-harian td {
            background-color: #06b6d4; /* Cyan-500 */
            color: #fff;
        }
        .divider-pembina td {
            background-color: #0e7490; /* Cyan-700 (Lebih gelap) */
            color: #fff;
        }
        /* END NEW DIVIDER STYLES */
        
        /* Shift Badges (Warna yang lebih soft) */
        .shift-badge-pagi {
            background-color: #e0f2f7; /* Cyan-100 (Sangat soft) */
            color: #0e7490; /* Cyan-700 */
        }
        .shift-badge-malam {
            background-color: #bfdbfe; /* Blue-200 (Biru Malam) */
            color: #1d4ed8; /* Blue-700 */
        }
        .shift-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        /* Style untuk sel kosong */
        .empty-cell {
            color: #94a3b8; /* Slate-400 */
            font-style: italic;
            font-size: 0.8rem;
        }
        
        /* Style untuk daftar pustakawan */
        .librarian-list {
             list-style: none;
             padding: 0;
             margin: 0;
             font-size: 0.95rem; 
             line-height: 1.4;
             color: #334155; /* Slate-700 */
        }
        .table-wrapper {
            width: 100%;
            overflow-x: auto;
        }
        
        /* Judul Kartu - Header Putih */
        .card-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            background-color: white; /* Diubah menjadi PUTIH */
            display: flex;
            justify-content: space-between; 
            align-items: center;
        }
        
        /* Logo Styling */
        .logo {
            height: 48px; 
            width: auto;
        }

        /* Title Group Styling */
        .header-title-group {
            text-align: right; 
        }

        /* ======================================= */
        /* MEDIA PRINT STYLES (Print-Friendly) */
        /* ======================================= */
        @media print {
            /* 1. Reset Body/Card Layout */
            body {
                background-color: white !important;
                padding: 0 !important;
                margin: 0;
                display: block;
                width: 100%;
                font-size: 10pt; 
            }
            .container-card {
                width: 100% !important;
                max-width: none !important;
                box-shadow: none !important; 
                border-radius: 0 !important; 
                overflow: visible !important;
                border: none !important; /* Hilangkan border kartu saat dicetak */
            }
            .table-wrapper {
                overflow-x: visible !important; 
            }

            /* 2. Header and Table Colors/Borders */
            .card-header, th {
                background-color: #e5e7eb !important; /* Latar belakang abu-abu terang */
                -webkit-print-color-adjust: exact; 
                color: #1f2937 !important;
                border-bottom: 1px solid #94a3b8 !important;
            }
            /* Pastikan Judul Kartu berwarna gelap saat dicetak */
            .card-header h1 {
                 color: #1f2937 !important; 
            }
            th {
                border-top: 2px solid #06b6d4 !important; /* Pertahankan aksen Cyan di header */
            }
            
            /* 3. Divider Colors (Jadikan hitam putih) */
            .divider-row td {
                color: white !important;
                background-color: #334155 !important; 
                border: 1px solid #94a3b8 !important;
                -webkit-print-color-adjust: exact;
            }

            /* 4. Badge Styles (Jadikan hitam putih, tetapi beri border) */
            .shift-badge {
                border: 1px solid #1f2937 !important;
                background-color: white !important;
                color: #1f2937 !important;
                -webkit-print-color-adjust: exact;
            }
            .shift-badge-pagi { border-color: #0e7490 !important; }
            .shift-badge-malam { border-color: #1d4ed8 !important; }
            
            /* 5. General Table Styles */
            th, td {
                border-color: #d1d5db !important;
                padding: 10px 8px !important; 
            }
        }
    </style>
</head>
<body>

    <div class="container-card">
        <div class="card-header">
             <img src="logo.png" alt="Logo Organisasi" class="logo">
             
             <div class="header-title-group">
                 <h1 class="text-2xl font-extrabold text-gray-800">Jadwal Piket Pustakawan</h1>
             </div>
        </div>
        <div id="schedule-table-container" class="table-wrapper">
            <div id="loading-indicator" class="text-center py-20 text-gray-500 text-xl font-medium">Memuat Jadwal...</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // =================================================================
        // KONFIGURASI FIREBASE (HARUS SAMA DENGAN FILE LAIN)
        // =================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyBb-hbcc_ZE2hH6dlc81HbIGMQi96y4qYI",
            authDomain: "absensi-7ef83.firebaseapp.com",
            databaseURL: "https://absensi-7ef83-default-rtdb.firebaseio.com",
            projectId: "absensi-7ef83",
            storageBucket: "absensi-7ef83.firebasestorage.app",
            messagingSenderId: "661765044421",
            appId: "1:661765044421:web:b8578a195a6d208dc4d8ac"
        };
        // =================================================================

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Hari diurutkan dari Senin hingga Ahad untuk kolom horizontal
        const DAYS_OF_WEEK_ORDERED = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Ahad'];
        
        // Semua shift yang relevan
        const ALL_SHIFTS = [
            { key: 'pagi', name: 'Pagi', time: '08:00 - 11:00', badgeClass: 'shift-badge-pagi' },
            { key: 'malam', name: 'Malam', time: '21:00 - 22:30', badgeClass: 'shift-badge-malam' }
        ];

        const TOTAL_COLUMNS = DAYS_OF_WEEK_ORDERED.length + 1; // 8 kolom (Shift + 7 Hari)

        /**
         * Mengambil data jadwal mingguan dan merendernya ke tabel horizontal.
         */
        async function loadAndRenderSchedule() {
            const container = document.getElementById('schedule-table-container');

            try {
                const scheduleRef = ref(db, 'recurring_templates');
                const snapshot = await get(scheduleRef);
                const weeklySchedule = snapshot.val() || {};

                renderHorizontalTable(weeklySchedule, container);

            } catch (e) {
                console.error("Gagal memuat jadwal:", e);
                container.innerHTML = `
                    <div class="text-center py-20 text-red-500 text-xl font-medium">
                        Error: Gagal memuat data jadwal. Cek koneksi Firebase.
                    </div>
                `;
            }
        }

        /**
         * Membuat HTML untuk satu baris shift (Pagi atau Malam).
         */
        function renderShiftRow(shiftInfo, weeklySchedule) {
            const shiftKey = shiftInfo.key;
            let rowHtml = '<tr>';
            
            // First cell: Shift Name and Time
            rowHtml += `
                <td>
                    <span class="shift-badge ${shiftInfo.badgeClass}">${shiftInfo.name}</span>
                    <div class="text-xs text-gray-500">${shiftInfo.time}</div>
                </td>
            `;
            
            // Other cells: Librarians for each day
            DAYS_OF_WEEK_ORDERED.forEach(day => {
                const daySchedule = weeklySchedule[day] || {};
                const librarians = daySchedule[shiftKey] || [];
                
                rowHtml += `<td>`;
                if (librarians.length > 0) {
                    rowHtml += `<ul class="librarian-list">`;
                    // Urutkan nama untuk tampilan yang rapi
                    librarians.sort((a,b) => a.name.localeCompare(b.name));
                    librarians.forEach(lib => {
                        rowHtml += `<span>${lib.name}</span><br>`;
                    });
                    rowHtml += `</ul>`;
                } else {
                    rowHtml += `<span class="empty-cell">Kosong</span>`;
                }
                rowHtml += `</td>`;
            });
            
            rowHtml += '</tr>';
            return rowHtml;
        }

        /**
         * Membuat HTML untuk baris pembatas (Harian atau Pembina).
         */
        function createDividerRow(label, className) {
             // Menggunakan TOTAL_COLUMNS untuk colspan
             return `
                <tr class="divider-row ${className}">
                    <td colspan="${TOTAL_COLUMNS}">${label}</td>
                </tr>
            `;
        }


        /**
         * Membangun dan menampilkan tabel jadwal mingguan secara horizontal.
         */
        function renderHorizontalTable(weeklySchedule, container) {
            
            // 1. Setup Header (Days as columns)
            let headerHtml = '<th>Shift & Waktu</th>'; // First column for shift/time
            DAYS_OF_WEEK_ORDERED.forEach(day => {
                headerHtml += `<th class="text-center">${day}</th>`;
            });

            // 2. Setup Body (Sequential rendering)
            let bodyHtml = '';
            
            // --- BAGIAN PAGI ---
            const pagiShiftInfo = ALL_SHIFTS.find(s => s.key === 'pagi');
            if (pagiShiftInfo) {
                bodyHtml += renderShiftRow(pagiShiftInfo, weeklySchedule);
            }

            // --- PEMBATAS 1: Harian & Pembina (SETELAH PAGI) ---
            bodyHtml += createDividerRow('Harian', 'divider-harian');
            bodyHtml += createDividerRow('Pembina', 'divider-pembina');


            // --- BAGIAN MALAM ---
            const malamShiftInfo = ALL_SHIFTS.find(s => s.key === 'malam');
             if (malamShiftInfo) {
                bodyHtml += renderShiftRow(malamShiftInfo, weeklySchedule);
            }

            // --- PEMBATAS 2: Harian & Pembina (DI AKHIR) ---
            bodyHtml += createDividerRow('Harian', 'divider-harian');
            bodyHtml += createDividerRow('Pembina', 'divider-pembina');


            // 3. Assemble the full table HTML
            const fullTableHtml = `
                <table class="w-full divide-y divide-gray-200" style="border-collapse: collapse;">
                    <thead>
                        <tr>${headerHtml}</tr>
                    </thead>
                    <tbody class="bg-white" id="schedule-tbody">
                        ${bodyHtml}
                    </tbody>
                </table>
            `;

            if (bodyHtml.length > 0) {
                container.innerHTML = fullTableHtml;
            } else {
                 container.innerHTML = `
                    <div class="text-center py-20 text-gray-700 text-xl font-medium">
                        <h3 class="font-bold mb-2">Jadwal Kosong</h3>
                        <p class="text-base text-gray-500">Tidak ada jadwal shift yang terdefinisi dalam database.</p>
                    </div>
                 `;
            }
        }

        // --- INIT APP ---
        window.onload = () => {
             loadAndRenderSchedule();
        };
    </script>
</body>
</html>
